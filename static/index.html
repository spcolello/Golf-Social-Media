<!DOCTYPE html>
<html>
    <body>
        <h2>Log In</h2>

        <input id ="username" placeholder="username" />
        <input id ="password" type="password" placeholder="password" />
        <button id = "loginBtn">Log In</button>
        
        <button id = "createUserBtn">Create Account</button>

        <pre id = "output"></pre>

        <script>
            document.getElementById("loginBtn").onclick = async() => {
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                if (!username || !password) {
                    document.getElementById("output").textContent = "Username and Password Required";
                    return;
                }

                try {
                    const res = await fetch("/login", {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify({username, password})
                    });

                    const data = await res.json();

                    if (!res.ok) {
                        document.getElementById("output").textContent = "Error: " + (data.detail || "Login failed");
                    } else {
                        document.getElementById("output").textContent = "Success! Logged in as:\n\n" + JSON.stringify(data, null, 2);
                        document.getElementById("username").value = "";
                        document.getElementById("password").value = "";
                        setTimeout(() => {
                            window.location.href = "/feed.html";
                        }, 1500);
                    }
                } catch (error) {
                    document.getElementById("output").textContent = "Error: " + error.message;
                }
            }

            document.getElementById("createUserBtn").onclick = async() => {
                window.location.href = "/create-account.html";
            }; 
        </script>
    </body>
</html>